<div class="interview-create">
  <div class="page-header">
    <h1>Create Interview</h1>
    <p class="subtitle">Schedule a new interview</p>
  </div>

  <mat-card class="form-card">
    <form [formGroup]="interviewForm" (ngSubmit)="onSubmit()">
      <mat-stepper #stepper linear>
        <!-- Step 1: Basic Details -->
        <mat-step [stepControl]="basicDetailsGroup" label="Basic Details">
          <div class="form-section" [formGroup]="basicDetailsGroup">
            <mat-form-field appearance="outline">
              <mat-label>Interview Title</mat-label>
              <input
                matInput
                formControlName="title"
                placeholder="e.g., Senior Frontend Developer Interview"
                required
              />
              @if (basicDetailsGroup.get('title')?.hasError('required')) {
                <mat-error>
                  Title is required
                </mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Description</mat-label>
              <textarea
                matInput
                formControlName="description"
                rows="3"
                placeholder="Interview description..."
              ></textarea>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Interview Type</mat-label>
              <mat-select formControlName="type" required>
                <mat-option value="TECHNICAL">Technical</mat-option>
                <mat-option value="HR">HR</mat-option>
                <mat-option value="MANAGERIAL">Managerial</mat-option>
                <mat-option value="CODING">Coding</mat-option>
                <mat-option value="BEHAVIORAL">Behavioral</mat-option>
                <mat-option value="SYSTEM_DESIGN">System Design</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Round</mat-label>
              <input matInput type="number" formControlName="round" min="1" required />
            </mat-form-field>

            <div class="step-actions">
              <button mat-raised-button color="primary" matStepperNext>Next</button>
            </div>
          </div>
        </mat-step>

        <!-- Step 2: Schedule -->
        <mat-step [stepControl]="scheduleGroup" label="Schedule">
          <div class="form-section" [formGroup]="scheduleGroup">
            <mat-form-field appearance="outline">
              <mat-label>Scheduled Date & Time</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="scheduledDate" required />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Duration (minutes)</mat-label>
              <input
                matInput
                type="number"
                formControlName="duration"
                min="15"
                step="15"
                required
              />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Location</mat-label>
              <input
                matInput
                formControlName="location"
                placeholder="Office address or meeting link"
              />
            </mat-form-field>

            <div class="step-actions">
              <button mat-button matStepperPrevious>Back</button>
              <button mat-raised-button color="primary" matStepperNext>Next</button>
            </div>
          </div>
        </mat-step>

        <!-- Step 3: Participants -->
        <mat-step [stepControl]="participantsGroup" label="Participants">
          <div class="form-section" [formGroup]="participantsGroup">
            <mat-form-field appearance="outline">
              <mat-label>Candidate Email (optional)</mat-label>
              <input
                matInput
                formControlName="candidateEmail"
                type="email"
                placeholder="candidate@example.com"
              />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Interviewers</mat-label>
              <mat-select formControlName="interviewerIds" multiple required>
                @for (interviewer of availableInterviewers(); track interviewer.id) {
                  <mat-option [value]="interviewer.id">
                    {{ interviewer.name }}
                  </mat-option>
                }
              </mat-select>
              <mat-hint>Select one or more interviewers</mat-hint>
            </mat-form-field>

            <div class="step-actions">
              <button mat-button matStepperPrevious>Back</button>
              <button mat-raised-button color="primary" matStepperNext>Review</button>
            </div>
          </div>
        </mat-step>

        <!-- Step 4: Review -->
        <mat-step label="Review">
          <div class="review-section">
            <h3>Review Interview Details</h3>
            <div class="review-grid">
              <div class="review-item">
                <label>Title:</label>
                <span>{{ basicDetailsGroup.value.title }}</span>
              </div>
              <div class="review-item">
                <label>Type:</label>
                <span>{{ basicDetailsGroup.value.type }}</span>
              </div>
              <div class="review-item">
                <label>Round:</label>
                <span>{{ basicDetailsGroup.value.round }}</span>
              </div>
              <div class="review-item">
                <label>Scheduled:</label>
                <span>{{ scheduleGroup.value.scheduledDate | date : 'full' }}</span>
              </div>
              <div class="review-item">
                <label>Duration:</label>
                <span>{{ scheduleGroup.value.duration }} minutes</span>
              </div>
              <div class="review-item">
                <label>Location:</label>
                <span>{{ scheduleGroup.value.location || 'Not specified' }}</span>
              </div>
            </div>

            <div class="step-actions">
              <button mat-button matStepperPrevious>Back</button>
              <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting()">
                @if (isSubmitting()) {
                <mat-spinner diameter="20"></mat-spinner>
                Creating... } @else { Create Interview }
              </button>
            </div>
          </div>
        </mat-step>
      </mat-stepper>
    </form>
  </mat-card>
</div>
